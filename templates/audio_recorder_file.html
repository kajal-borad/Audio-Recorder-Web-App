<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>MediaX â€“ Friendly Video Converter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* --- CSS FROM MediaX_denny/style.css --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #e0f2fe, #fef3c7);
            color: #111827;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background 0.3s, color 0.3s;
        }

        /* Navbar (Black header) */
        .navbar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background-color: #222;
            color: white;
        }

        .navbar .logo {
            font-size: 20px;
            font-weight: 700;
            color: white;
        }

        .navbar a {
            color: white;
            margin-left: 20px;
            text-decoration: none;
            font-weight: bold;
            font-size: 14px;
        }

        .navbar a:hover {
            text-decoration: underline;
        }

        .main {
            flex: 1;
            width: 100%;
            max-width: 960px;
            padding: 24px 20px 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 22px;
        }

        .hero {
            text-align: center;
            max-width: 540px;
        }

        .hero h1 {
            font-size: 30px;
            margin-bottom: 6px;
        }

        .hero p {
            font-size: 14px;
            color: #4b5563;
        }

        .card {
            width: 100%;
            max-width: 560px;
            padding: 20px 18px 18px;
            border-radius: 18px;
            background: #f9fafb;
            border: 1px solid rgba(148, 163, 184, .4);
            box-shadow: 0 14px 35px rgba(148, 163, 184, .4);
            transition: background 0.3s, border-color 0.3s;
        }

        .card-header h2 {
            font-size: 20px;
            margin-bottom: 2px;
        }

        .card-subtitle {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 10px;
        }

        .label {
            font-size: 12px;
            color: #4b5563;
            margin-bottom: 6px;
            display: block;
        }

        input[type=url],
        input[type=text] {
            width: 100%;
            border-radius: 10px;
            border: 1px solid #cbd5e1;
            padding: 9px 10px;
            font-size: 13px;
            margin-bottom: 12px;
            background: #fff;
            color: inherit;
        }

        input::placeholder {
            color: #9ca3af
        }

        input:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 1px rgba(34, 197, 94, .5);
        }

        .row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .field {
            flex: 1 1 150px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .label-small {
            font-size: 11px;
            color: #6b7280;
        }

        select {
            border-radius: 10px;
            border: 1px solid #cbd5e1;
            padding: 7px 9px;
            font-size: 13px;
            background: #ffffff;
            color: inherit;
            width: 100%;
        }

        select:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 1px rgba(34, 197, 94, .5);
        }

        .hint {
            font-size: 11px;
            color: #6b7280;
            flex: 1 1 200px;
            margin-bottom: 10px;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 4px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .primary,
        .secondary {
            flex: 1 1 140px;
            border-radius: 999px;
            border: none;
            padding: 10px 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .primary {
            background: #22c55e;
            color: #f9fafb;
        }

        .primary:active {
            transform: translateY(1px);
        }

        .secondary {
            background: #e5e7eb;
            color: #111827;
        }

        .secondary:active {
            transform: translateY(1px);
        }

        .status-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 999px;
            background: #22c55e;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, .28);
            flex-shrink: 0;
        }

        .status {
            font-size: 11px;
            color: #4b5563;
        }

        .loader {
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: #4b5563;
            margin-bottom: 8px;
        }

        .loader.active {
            display: flex;
        }

        .spinner {
            width: 14px;
            height: 14px;
            border-radius: 999px;
            border: 2px solid rgba(148, 163, 184, .6);
            border-top-color: #22c55e;
            animation: spin .7s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .footer {
            width: 100%;
            max-width: 960px;
            padding: 10px 20px 18px;
            text-align: center;
            font-size: 11px;
            color: #4b5563;
        }

        /* Responsive adaptations */
        @media(max-width:600px) {
            .navbar {
                padding: 12px 15px;
            }

            .navbar .logo {
                font-size: 18px;
            }

            .menu a {
                margin-left: 12px;
                font-size: 13px;
            }

            .menu button {
                margin-left: 12px;
                padding: 6px 10px;
                font-size: 12px;
            }

            .main {
                padding: 18px 14px 32px;
            }

            .card {
                padding: 16px;
                margin-top: 10px;
            }

            .row {
                gap: 8px;
            }

            .actions {
                gap: 8px;
                margin-top: 14px;
                flex-direction: column;
            }

            input,
            select {
                font-size: 15px;
                padding: 12px;
            }

            button {
                padding: 12px;
                font-size: 15px;
                border-radius: 10px;
            }
        }

        .menu {
            display: flex;
            align-items: center;
        }

        .menu button {
            margin-left: 20px;
            padding: 8px 15px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: #555;
            color: white;
            font-weight: 500;
            font-size: 13px;
        }

        .menu button:hover {
            background-color: #777;
        }


        /* --- DARK MODE --- */
        body.dark {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #f3f4f6;
        }

        body.dark .logo {
            color: #f3f4f6;
        }

        body.dark .card {
            background: #1e293b;
            border-color: #374151;
            box-shadow: 0 14px 35px rgba(0, 0, 0, 0.4);
        }

        body.dark .card-subtitle,
        body.dark .label,
        body.dark .hero p,
        body.dark .status,
        body.dark .label-small,
        body.dark .hint,
        body.dark .footer,
        body.dark .loader {
            color: #9ca3af;
        }

        body.dark input[type=url],
        body.dark input[type=text],
        body.dark select {
            background: #334155;
            border-color: #475569;
            color: #f3f4f6;
        }

        body.dark input::placeholder {
            color: #64748b;
        }

        body.dark .secondary {
            background: #334155;
            color: #f3f4f6;
        }

        body.dark .secondary:hover {
            background: #475569;
        }


        body.dark .flash-messages {
            background: #451a03;
            border-color: #92400e;
        }

        body.dark .flash-messages li {
            color: #fcd34d;
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="logo">âˆžMP3</div>
        <div class="menu">
            <a href="/">Home</a>
            <a href="/contact">Contact Us</a>
            <button id="darkToggle">Dark Mode ðŸŒ™</button>
        </div>
    </nav>


    <main class="main">
        <section class="hero">
            <h1>Friendly video converter</h1>
            <p>Single-page, fast and simple. Paste a URL, choose format &amp; quality.</p>
        </section>

        <section class="card" aria-label="Video converter">
            <div class="card-header">
                <h2>Convert a video link</h2>
                <p class="card-subtitle">All controls and results in one clean page.</p>
            </div>

            {% with messages = get_flashed_messages() %}
            {% if messages %}
            <div class="row">
                <ul class="flash-messages"
                    style="width:100%; list-style:none; background:#fffbeb; color:#92400e; padding:10px; border-radius:8px; margin-bottom:12px; font-size:13px; border:1px solid #fcd34d;">
                    {% for msg in messages %}
                    <li>{{ msg }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            {% endwith %}

            <form action="/download" method="POST">
                <label class="label" for="url">Video URL</label>
                <input id="url" name="youtube_url" type="text" placeholder="https://example.com/watch?v=..."
                    autocomplete="off" value="{{ youtube_url or '' }}" required />

                <div class="row">
                    <div class="field">
                        <span class="label-small">Format</span>
                        <select id="format" name="format_type">
                            <option value="mp3">MP3 (audio)</option>
                            <option value="mp4">MP4 (video)</option>
                        </select>
                    </div>
                    <div class="field">
                        <span class="label-small">Quality</span>
                        <select id="qualitySelect" name="quality">
                            <option value="128k" selected>default (128k)</option>
                        </select>
                    </div>
                </div>

                <p class="hint">
                    Quality options will update based on the video you paste.
                </p>

                <div id="loader" class="loader">
                    <div class="spinner"></div>Processing...
                </div>

                <div class="actions">
                    <button type="submit" id="convertBtn" class="primary">Convert</button>
                    <button id="resetBtn" class="secondary" type="button">Reset</button>
                </div>

                <div class="status-row">
                    <div class="status-dot" id="statusDot"></div>
                    <p id="status" class="status">Ready â€“ paste a link to get started.</p>
                </div>
            </form>
        </section>
    </main>

    <footer class="footer">
        Soft pastel single-page converter Â· Front-end preview only â€“ connect your own backend.
    </footer>

    <script>
        /* =========================
           DARK MODE
        ========================= */
        const darkToggle = document.getElementById('darkToggle');
        const body = document.body;

        function applyTheme(theme) {
            if (theme === 'dark') {
                body.classList.add('dark');
                darkToggle.textContent = 'Light Mode â˜€ï¸';
            } else {
                body.classList.remove('dark');
                darkToggle.textContent = 'Dark Mode ðŸŒ™';
            }

        }

        const savedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(savedTheme);

        darkToggle.addEventListener('click', () => {
            const newTheme = body.classList.contains('dark') ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });

        /* =========================
           DYNAMIC QUALITY FETCH
        ========================= */
        let timer = null;
        document.querySelector("input[name='youtube_url']").addEventListener("input", function () {
            clearTimeout(timer);
            const url = this.value;
            if (!url) return;

            timer = setTimeout(() => {
                fetch("/get_info", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: "youtube_url=" + encodeURIComponent(url)
                })
                    .then(res => res.json())
                    .then(data => {
                        const select = document.getElementById("qualitySelect");
                        select.innerHTML = '<option value="128k" selected>default (128k)</option>';
                        if (!data.bitrates) return;
                        data.bitrates
                            .filter(b => b !== 128 && b !== 129)
                            .forEach(b => {
                                select.innerHTML += `<option value="${b}k">${b}k</option>`;
                            });
                    })
                    .catch(err => console.error("Error fetching quality:", err));
            }, 400);
        });

        /* =========================
           RESET BUTTON
        ========================= */
        document.getElementById('resetBtn').addEventListener('click', () => {
            document.getElementById('url').value = '';
            document.getElementById('format').value = 'mp3';
            document.getElementById('qualitySelect').innerHTML = '<option value="128k" selected>default (128k)</option>';
            document.getElementById('status').textContent = 'Ready â€“ paste a link to get started.';
            document.getElementById('loader').classList.remove('active');
            document.getElementById('statusDot').style.background = '#22c55e';
        });

        /* =========================
           FORM SUBMIT + DOWNLOAD
        ========================= */
        document.querySelector("form").addEventListener("submit", function (e) {
            e.preventDefault();
            const form = this;
            const formData = new FormData(form);

            // UI State: Loading
            document.getElementById("loader").classList.add("active");
            document.getElementById("status").textContent = "Processing your request...";
            document.getElementById('statusDot').style.background = '#eab308'; // yellow

            fetch(form.action, {
                method: form.method,
                body: formData
            })
                .then(async res => {
                    if (!res.ok) throw new Error("Request failed");
                    const blob = await res.blob();
                    let filename = "downloaded_file";
                    const disposition = res.headers.get("Content-Disposition");
                    if (disposition && disposition.includes("filename=")) {
                        filename = disposition.split("filename=")[1].replace(/"/g, "");
                    }

                    const a = document.createElement("a");
                    const url = URL.createObjectURL(blob);
                    a.href = url;
                    a.download = filename;
                    a.click();
                    URL.revokeObjectURL(url);

                    // UI State: Success
                    document.getElementById("loader").classList.remove("active");
                    document.getElementById("status").textContent = "Download complete!";
                    document.getElementById('statusDot').style.background = '#22c55e'; // green
                })
                .catch(err => {
                    console.error(err);
                    // UI State: Error
                    document.getElementById("loader").classList.remove("active");
                    document.getElementById("status").textContent = "Error occurred. Please try again.";
                    document.getElementById('statusDot').style.background = '#ef4444'; // red
                });
        });
    </script>
</body>

</html>