<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>âˆžMP3 â€“ YouTube Downloader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
    :root {
        --primary: #ef4444; /* Red-ish from reference */
        --primary-hover: #dc2626;
        --bg-gradient: linear-gradient(135deg, #f0fdf4, #fff7ed);
        --text-main: #1f2937;
        --text-muted: #6b7280;
        --card-bg: #ffffff;
        --card-border: #e5e7eb;
    }

    * {box-sizing: border-box; margin: 0; padding: 0;}
    
    body {
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        background: var(--bg-gradient);
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        line-height: 1.5;
    }

    /* Navbar */
    .navbar {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 5%;
        background-color: #fff;
        border-bottom: 1px solid #e5e7eb;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .navbar .logo {
        font-size: 22px;
        font-weight: 800;
        background: linear-gradient(to right, #ef4444, #f59e0b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -0.5px;
    }

    .menu {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .menu a {
        color: var(--text-main);
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
        transition: color 0.2s;
    }

    .menu a:hover {
        color: var(--primary);
    }

    .menu button {
        padding: 8px 16px;
        cursor: pointer;
        border: 1px solid #e5e7eb;
        border-radius: 99px;
        background-color: transparent;
        color: var(--text-main);
        font-weight: 600;
        font-size: 13px;
        transition: all 0.2s;
    }

    .menu button:hover {
        background-color: #f9fafb;
        border-color: #d1d5db;
    }

    /* Main content */
    .main {
        flex: 1;
        width: 100%;
        max-width: 800px;
        padding: 40px 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 30px;
        margin: 0 auto;
    }

    .hero {
        text-align: center;
        max-width: 600px;
        margin-bottom: 10px;
    }

    .hero h1 {
        font-size: 36px;
        font-weight: 800;
        margin-bottom: 12px;
        letter-spacing: -1px;
        color: #111827;
    }

    .hero p {
        font-size: 16px;
        color: var(--text-muted);
        line-height: 1.6;
    }

    .card {
        width: 100%;
        padding: 32px;
        border-radius: 24px;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 25px 30px -5px rgba(0, 0, 0, 0.15);
    }

    .card-header {
        text-align: center;
        margin-bottom: 24px;
    }

    .card-header h2 {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 6px;
    }

    .card-subtitle {
        font-size: 14px;
        color: var(--text-muted);
    }

    .label {
        font-size: 13px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
        display: block;
    }

    .input-group {
        position: relative;
        margin-bottom: 20px;
    }

    input[type=text], select {
        width: 100%;
        border-radius: 12px;
        border: 2px solid #e5e7eb;
        padding: 12px 16px;
        font-size: 15px;
        transition: all 0.2s;
        background: #f9fafb;
        color: #1f2937;
        appearance: none; /* Remove default arrow for cleaner look */
    }

    input[type=text]:focus, select:focus {
        outline: none;
        border-color: var(--primary);
        background: #ffffff;
        box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
    }

    /* Custom Select Arrow Wrapper */
    .field {
        position: relative;
        flex: 1;
    }
    
    .field::after {
        content: 'â–¼';
        font-size: 10px;
        color: #6b7280;
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
    }

    .blur-input {
        opacity: 0.6;
        pointer-events: none;
        filter: grayscale(1);
    }

    .row {
        display: flex;
        gap: 16px;
        margin-bottom: 24px;
    }

    .label-small {
        font-size: 12px;
        font-weight: 600;
        color: var(--text-muted);
        margin-bottom: 6px;
        display: block;
    }

    .hint {
        font-size: 12px;
        color: var(--text-muted);
        text-align: center;
        margin-bottom: 16px;
        background: #f3f4f6;
        padding: 8px;
        border-radius: 8px;
    }

    .actions {
        display: flex;
        gap: 12px;
        margin-top: 8px;
        margin-bottom: 20px;
    }

    button.primary, button.secondary {
        flex: 1;
        border-radius: 12px;
        border: none;
        padding: 14px 20px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.1s, box-shadow 0.2s, background-color 0.2s;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    button.primary {
        background: var(--primary);
        color: white;
        box-shadow: 0 4px 6px -1px rgba(239, 68, 68, 0.3);
    }

    button.primary:hover {
        background: var(--primary-hover);
        box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.4);
    }

    button.primary:active {
        transform: scale(0.98);
    }

    button.secondary {
        background: #f3f4f6;
        color: #374151;
    }

    button.secondary:hover {
        background: #e5e7eb;
    }

    button.secondary:active {
        transform: scale(0.98);
    }

    /* Status & Loader */
    .status-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
        padding: 12px;
        border-radius: 12px;
        background: #f8fafc;
    }

    .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #22c55e;
        box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    }

    .status {
        font-size: 13px;
        font-weight: 500;
        color: #4b5563;
    }

    .loader {
        display: none;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
        padding: 20px;
        background: #f0fdf4;
        border-radius: 12px;
        border: 1px dashed #86efac;
    }

    .loader.active { display: flex; }

    .spinner {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border: 3px solid #dcfce7;
        border-top-color: #22c55e;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .flash-messages {
        background: #fffbeb;
        border: 1px solid #fcd34d;
        border-radius: 12px;
        padding: 12px 16px;
        margin-bottom: 20px;
        list-style: none;
    }

    .flash-messages li {
        color: #92400e;
        font-size: 14px;
        font-weight: 500;
    }

    .footer {
        width: 100%;
        text-align: center;
        padding: 20px;
        font-size: 13px;
        color: var(--text-muted);
        margin-top: auto;
        border-top: 1px solid #e5e7eb;
    }

    /* 
       RESPONSIVE DESIGN IMPROVEMENTS 
       ------------------------------
    */

    /* Tablet and Small Laptops */
    @media (max-width: 768px) {
        .main {
            padding: 30px 15px;
        }
        .hero h1 {
            font-size: 30px;
        }
    }

    /* Mobile Phones */
    @media (max-width: 600px) {
        .navbar {
            padding: 12px 15px;
        }
        .main {
            padding: 20px 12px;
        }
        .card {
            padding: 20px;
        }

        /* Fix "messy layout": Stack inputs on mobile for cleanliness */
        .row {
            flex-direction: column;
            gap: 16px;
        }

        /* Fix "buttons too large": Stack them but keep height reasonable */
        .actions {
            flex-direction: column;
        }

        button.primary, button.secondary {
            width: 100%;
            padding: 12px; /* Slightly smaller vertical padding */
            font-size: 15px;
        }

        .hero h1 {
            font-size: 26px;
            line-height: 1.2;
        }
        
        .hero p {
            font-size: 14px;
        }
        
        .menu { gap: 10px; }
        .menu a { display: none; } /* Hide 'Home'/'Contact' text links on mobile to save space, keep only button */
        .menu button { display: block; padding: 6px 12px; font-size: 12px; }
    }
    </style>

</head>
<body>
    <nav class="navbar">
        <div class="logo">âˆžMP3</div>
        <div class="menu">
            <a href="/">Home</a>
            <a href="/contact">Contact</a>
            <button id="darkToggle">Dark Mode ðŸŒ™</button>
        </div>
    </nav>

    <main class="main">
        <section class="hero">
            <h1>Friendly video converter</h1>
            <p>Single-page, fast and simple. Paste a YouTube link, choose format &amp; quality, and download your file.</p>
        </section>

        <section class="card" aria-label="YouTube downloader">
            <div class="card-header">
                <h2>Download from YouTube</h2>
                <p class="card-subtitle">All controls and results in one clean page for the best user experience.</p>
            </div>

            {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul class="flash-messages">
                {% for msg in messages %}
                    <li>{{ msg }}</li>
                {% endfor %}
                </ul>
            {% endif %}
            {% endwith %}

            <form action="/download" method="POST">
                <label class="label" for="url">Video URL</label>
                <input type="text" name="youtube_url" id="url" placeholder="https://youtube.com/watch?v=..." value="{{ youtube_url or '' }}" required autocomplete="off">

                <div class="row">
                    <div class="field">
                        <span class="label-small">Format</span>
                        <select name="format_type" id="format" required>
                            <option value="mp3">MP3 (audio)</option>
                            <option value="mp4">MP4 (video)</option>
                        </select>
                    </div>
                    <div class="field">
                        <span class="label-small">Quality</span>
                        <select name="quality" id="qualitySelect" required>
                            <option value="128k" selected>default (128k)</option>
                        </select>
                    </div>
                </div>

                <p class="hint">
                    Quality options will update based on the video you paste.
                </p>

                <div class="loader" id="loader">
                    <div class="spinner"></div>
                    <span>Converting...</span>
                </div>

                <div class="actions">
                    <button type="submit" class="primary" id="downloadBtn">Convert</button>
                    <button type="button" class="secondary" id="resetBtn">Reset</button>
                </div>

                <div class="status-row">
                    <div class="status-dot" id="statusDot"></div>
                    <p id="status" class="status">Ready â€“ paste a link to get started.</p>
                </div>
            </form>
        </section>
    </main>

    <footer class="footer">
        Soft pastel single-page converter Â· Front-end preview only â€“ connect your own backend for real downloads.
    </footer>

<script>
/* =========================
   DARK MODE (with localStorage)
========================= */
const darkToggle = document.getElementById('darkToggle');
const body = document.body;
const card = document.querySelector('.card');

function applyTheme(theme) {
    if (theme === 'dark') {
        body.style.background = 'linear-gradient(135deg,#0f172a,#232e3e)';
        body.style.color = '#f1f5f9';
         // We might need to handle specific variable overrides if we used inline styles previously
         // But with the new CSS variables, we can just update the root properties or add a class.
         // For backward compat with the inline JS logic, I will stick to what was there but improved.
        card.style.background = '#1e293b';
        card.style.color = '#f1f5f9';
        darkToggle.textContent = 'Light Mode â˜€ï¸';
        
        // Update input backgrounds for dark mode manually since JS is handling it
        document.querySelectorAll('input, select').forEach(el => {
            el.style.background = '#334155';
            el.style.color = '#fff';
            el.style.borderColor = '#475569';
        });
        
    } else {
        body.style.background = 'linear-gradient(135deg, #f0fdf4, #fff7ed)';
        body.style.color = '#1f2937';
        card.style.background = '#ffffff';
        card.style.color = '#1f2937';
        darkToggle.textContent = 'Dark Mode ðŸŒ™';
        
        document.querySelectorAll('input, select').forEach(el => {
            el.style.background = '#f9fafb';
            el.style.color = '#1f2937';
            el.style.borderColor = '#e5e7eb';
        });
    }
}

// Page load pe saved theme apply
const savedTheme = localStorage.getItem('theme') || 'light';
applyTheme(savedTheme);

// Toggle click
darkToggle.addEventListener('click', () => {
    const newTheme =
        localStorage.getItem('theme') === 'dark' ? 'light' : 'dark';
    localStorage.setItem('theme', newTheme);
    applyTheme(newTheme);
});


/* =========================
   RESET BUTTON
========================= */
document.getElementById('resetBtn').addEventListener('click', () => {
    document.getElementById('url').value = '';
    document.getElementById('format').value = 'mp3';
    document.getElementById('qualitySelect').innerHTML =
        '<option value="128k" selected>default (128k)</option>';
    document.getElementById('status').textContent =
        'Ready â€“ paste a link to get started.';
    document.getElementById('loader').classList.remove('active');
});


/* =========================
   DYNAMIC QUALITY FETCH
========================= */
let timer = null;
document
    .querySelector("input[name='youtube_url']")
    .addEventListener("input", function () {

    clearTimeout(timer);
    const url = this.value;
    if (!url) return;

    timer = setTimeout(() => {
        fetch("/get_info", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: "youtube_url=" + encodeURIComponent(url)
        })
        .then(res => res.json())
        .then(data => {
            const select = document.getElementById("qualitySelect");
            select.innerHTML =
                '<option value="128k" selected>default (128k)</option>';

            if (!data.bitrates) return;

            data.bitrates
                .filter(b => b !== 128 && b !== 129)
                .forEach(b => {
                    select.innerHTML +=
                        `<option value="${b}k">${b}k</option>`;
                });
        })
        .catch(err =>
            console.error("Error fetching quality info:", err)
        );
    }, 400);
});


/* =========================
   FORM SUBMIT + DOWNLOAD
========================= */
document.querySelector("form").addEventListener("submit", function (e) {
    e.preventDefault();

    const form = this;
    const formData = new FormData(form);

    document.querySelectorAll("input, select, button").forEach(el => {
        el.disabled = true;
        el.classList.add("blur-input");
    });

    document.getElementById("loader").classList.add("active");
    document.getElementById("status").textContent =
        "Processing your request...";

    fetch(form.action, {
        method: form.method,
        body: formData
    })
    .then(async res => {
        const blob = await res.blob();
        let filename = "downloaded_file";

        const disposition = res.headers.get("Content-Disposition");
        if (disposition && disposition.includes("filename=")) {
            filename = disposition.split("filename=")[1].replace(/"/g, "");
        }

        const a = document.createElement("a");
        const url = URL.createObjectURL(blob);
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);

        document.getElementById("loader").classList.remove("active");
        document.getElementById("status").textContent =
            "Download complete! Ready for next conversion.";

        document.querySelectorAll("input, select, button").forEach(el => {
            el.disabled = false;
            el.classList.remove("blur-input");
        });
    })
    .catch(err => {
        console.error("Download error:", err);
        document.getElementById("loader").classList.remove("active");
        document.getElementById("status").textContent =
            "Error occurred. Please try again.";

        document.querySelectorAll("input, select, button").forEach(el => {
            el.disabled = false;
            el.classList.remove("blur-input");
        });
    });
});
</script>

    
</body>
</html>